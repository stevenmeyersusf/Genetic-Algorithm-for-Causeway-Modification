C23456789012345678901234567890123456789012345678901234567890123456789012
      SUBROUTINE MONSAL(IUSAL3,MONAVGSAL,MONFLAG,MCNT)
C     COMPUTES MONTHLY AVERAGE SALINITY FIELDS FOR 1990-1991

      INCLUDE 'comdeck'
      PARAMETER(NMONS=24)
      
c     MONTIMES GIVES NUMBER OF DAYS IN EACH MONTH FOR 1990 AND 1991
      INTEGER IUSAL3,MONTIMES(NMONS),M,SUMTIMES(NMONS),CKFLAG,MCNT
      REAL MONAVGSAL(IM,JM,KB),TIME,DIFF

      DATA MONTIMES /31,28,31,30,31,30,31,31,30,31,30,31,
     &     31,28,31,30,31,30,31,31,30,31,30,31/
      
C     CALC NUMBER OF DAYS BEFORE EACH END OF MONTH STARTING 1/1/1990
      DO 50 I=1,NMONS
        SUMTIMES(I)=MONTIMES(I)      
        IF (I.GT.1) THEN 
        DO 51 I2=1,I-1
 51       SUMTIMES(I) = SUMTIMES(I)+MONTIMES(I2)
        ENDIF
 50   CONTINUE

      CKFLAG=0

C     CHECK IF NEW MONTH
      DO 100 M=1,NMONS
        DIFF = ABS(SUMTIMES(M)-TIME)*24.*60.*60. 
        IF (DIFF.LT.DTI/2.) CKFLAG=1        
 100  continue
      
C     END OF PREVIOUS MONTH, START NEW MONTH
      IF ((CKFLAG.EQ.1).AND.(MONFLAG.EQ.1)) THEN 
         WRITE(IUSAL3,*) TIME
         WRITE(IUSAL3,500)
     &     (((MONAVGSAL(I,J,K)/MCNT,I=1,IM),J=1,JM),K=1,KB)

         DO 200 I=1,IM
         DO 200 J=1,JM
         DO 200 K=1,KB
 200        MONAVGSAL(I,J,K)=S(I,J,K)
         MCNT=1
c         write(6,*) 'NEW MON',TIME,DIFF,DTI/2.,mcnt
      ENDIF

C     CONTINUE IN SAME MONTH
      IF ((CKFLAG.EQ.0).AND.(MONFLAG.EQ.1)) THEN 
         DO 300 I=1,IM
         DO 300 J=1,JM
         DO 300 K=1,KB
 300        MONAVGSAL(I,J,K)=S(I,J,K)+MONAVGSAL(I,J,K)
         MCNT = MCNT+1
c         write(6,*) 'OLD MON',TIME,DIFF,DTI/2.,mcnt
      ENDIF

 500  format(8(f7.3))

C     FIRST TIME STEP
      IF (INT.EQ.ISTART) THEN 
         DO 400 I=1,IM
         DO 400 J=1,JM
         DO 400 K=1,KB
 400        MONAVGSAL(I,J,K)=S(I,J,K)
         MCNT=1
         MONFLAG=1
c         write(6,*) 'FIRST',TIME,DIFF,DTI/2.,mcnt
      ENDIF


      END
